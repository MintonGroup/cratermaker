<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Simulation - CraterMaker Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">CraterMaker Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../cratermaker_overview/" class="nav-link">Overview</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">API Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../crater/" class="dropdown-item">Crater</a>
</li>
                                    
<li>
    <a href="../morphology/" class="dropdown-item">Morphology</a>
</li>
                                    
<li>
    <a href="../production/" class="dropdown-item">Production</a>
</li>
                                    
<li>
    <a href="../scale/" class="dropdown-item">Scale</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Simulation</a>
</li>
                                    
<li>
    <a href="../surface/" class="dropdown-item">Surface</a>
</li>
                                    
<li>
    <a href="../target/" class="dropdown-item">Target</a>
</li>
                                    
<li>
    <a href="../general_utils/" class="dropdown-item">General Utilities</a>
</li>
                                    
<li>
    <a href="../montecarlo/" class="dropdown-item">Monte Carlo Utilities</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../license/" class="nav-link">License</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../scale/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../surface/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#simulation-module" class="nav-link">Simulation Module</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#cratermaker.core.simulation" class="nav-link">simulation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cratermaker.core.simulation.Simulation" class="nav-link">Simulation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="simulation-module">Simulation Module</h1>


<div class="doc doc-object doc-module">



<a id="cratermaker.core.simulation"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="cratermaker.core.simulation.Simulation" class="doc doc-heading">
          <code>Simulation</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>This class orchestrates the processes involved in running a crater simulation.</p>
<h4 id="cratermaker.core.simulation.Simulation--attributes">Attributes</h4>
<p>pix : float
    Pixel resolution for the mesh.
target : Target
    The target body for the impact simulation.
rng : numpy.random.Generator
    Random number generator instance.</p>
<h4 id="cratermaker.core.simulation.Simulation--methods">Methods</h4>
<p>set_properties(<strong>kwargs):
    Set properties of the current object based on the provided keyword arguments.
to_json(filename):
    Export the current simulation configuration to a JSON file.
generate_crater(</strong>kwargs):
    Create a new Crater object and its corresponding Projectile.
generate_projectile(<strong>kwargs):
    Create a new Projectile object and its corresponding Crater.
emplace_crater(from_projectile=False, </strong>kwargs):
    Emplace a crater in the simulation, optionally based on a projectile.</p>

            <details class="quote">
              <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Simulation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class orchestrates the processes involved in running a crater simulation.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    pix : float</span>
<span class="sd">        Pixel resolution for the mesh.</span>
<span class="sd">    target : Target</span>
<span class="sd">        The target body for the impact simulation.</span>
<span class="sd">    rng : numpy.random.Generator</span>
<span class="sd">        Random number generator instance.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    set_properties(**kwargs):</span>
<span class="sd">        Set properties of the current object based on the provided keyword arguments.</span>
<span class="sd">    to_json(filename):</span>
<span class="sd">        Export the current simulation configuration to a JSON file.</span>
<span class="sd">    generate_crater(**kwargs):</span>
<span class="sd">        Create a new Crater object and its corresponding Projectile.</span>
<span class="sd">    generate_projectile(**kwargs):</span>
<span class="sd">        Create a new Projectile object and its corresponding Crater.</span>
<span class="sd">    emplace_crater(from_projectile=False, **kwargs):</span>
<span class="sd">        Emplace a crater in the simulation, optionally based on a projectile.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                <span class="n">target</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Target</span> <span class="o">=</span> <span class="s2">&quot;Moon&quot;</span><span class="p">,</span>
                <span class="n">material</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Material</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">pix</span><span class="p">:</span> <span class="n">FloatLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">reset_surface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">simdir</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="n">scale</span><span class="p">:</span> <span class="n">Scale</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">morphology</span><span class="p">:</span> <span class="n">Morphology</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Simulation object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target: str or Target, optional, default &quot;Moon&quot;</span>
<span class="sd">            Name of the target body or Target object for the simulation, default is &quot;Moon&quot;.</span>
<span class="sd">        material : str or Material, optional</span>
<span class="sd">            Name of the material or Material object for the target body, if None is passed, the default material for the target body is used.</span>
<span class="sd">        pix : float, optional</span>
<span class="sd">            Pixel resolution for the mesh, default is None.</span>
<span class="sd">        reset_surface : bool, optional</span>
<span class="sd">            Flag to reset the surface elevation, default is True.</span>
<span class="sd">        simdir: PathLike, optional</span>
<span class="sd">            Path to the simulation directory, default is current working directory.</span>
<span class="sd">        **kwargs : Any</span>
<span class="sd">            Additional keyword arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">simdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">simdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">simdir</span><span class="p">):</span>
            <span class="n">simdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">simdir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">simdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">simdir</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">simdir</span> <span class="o">=</span> <span class="n">simdir</span>

        <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">material</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid material name </span><span class="si">{</span><span class="n">material</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="n">Material</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;materiat must be an instance of Material or a valid name of a material&quot;</span><span class="p">)</span>        

        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="s2">&quot;Moon&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid target name </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Target</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
                <span class="n">target</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Target</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;target must be an instance of Target or a valid name of a target body&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">if</span> <span class="n">pix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">pix</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span>  <span class="c1"># Default mesh scale that is somewhat comparable to a 1000x1000 CTEM grid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_surface</span><span class="p">(</span><span class="n">pix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">reset_surface</span><span class="o">=</span><span class="n">reset_surface</span><span class="p">,</span> <span class="n">simdir</span><span class="o">=</span><span class="n">simdir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Set some default values for the simulation parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_function</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time_function&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tstart</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tstart&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># Simulation start time (in y)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tstop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tstop&#39;</span><span class="p">,</span> <span class="mf">4.31e9</span><span class="p">)</span>    <span class="c1"># Simulation stop time (in y)</span>

        <span class="c1"># Set some default values for the production function population</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impactor_sfd</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impactor_sfd&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impactor_velocity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impactor_velocity&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Set the random number generator seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_crater</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_projectile</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">Scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">Scale</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scale must be an instance of Scale&quot;</span><span class="p">)</span> 


        <span class="k">if</span> <span class="n">morphology</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morphology</span><span class="p">,</span> <span class="n">Morphology</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span> <span class="o">=</span> <span class="n">morphology</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;morphology must be an instance of Morphology&quot;</span><span class="p">)</span>

        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set properties of the current object based on the provided keyword arguments.</span>

<span class="sd">        This function is a utility to update the properties of the current object. The actual implementation of the </span>
<span class="sd">        property setting is handled by the `utils.set_properties` method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            A dictionary of keyword arguments that represent the properties to be set on the current object.</span>

<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> 


    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the current simulation configuration to a JSON file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The file path where the JSON configuration will be saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c1">#TODO: Re-do this once the dust settles a bit</span>
        <span class="c1"># Get the simulation configuration into the correct structure</span>
        <span class="n">material_config</span> <span class="o">=</span> <span class="n">to_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
        <span class="n">target_config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">to_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;material&#39;</span> <span class="p">:</span> <span class="n">material_config</span><span class="p">}</span>
        <span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span><span class="s1">&#39;target&#39;</span> <span class="p">:</span> <span class="n">target_config</span><span class="p">}</span> 

        <span class="c1"># Write the combined configuration to a JSON file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sim_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">initialize_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the surface mesh.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : dict</span>
<span class="sd">            Variable length argument list to pass to initialize_surface.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for initializing the surface mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="n">initialize_surface</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">generate_crater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Crater object and its corresponding Projectile.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for initializing the Crater object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (Crater, Projectile)</span>
<span class="sd">            A tuple containing the newly created Crater and Projectile objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c1"># Create a new Crater object with the passed arguments and set it as the crater of this simulation</span>
        <span class="n">crater</span> <span class="o">=</span> <span class="n">Crater</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">projectile</span> <span class="o">=</span> <span class="n">crater</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">crater_to_projectile</span><span class="p">(</span><span class="n">crater</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">crater</span><span class="p">,</span> <span class="n">projectile</span>


    <span class="k">def</span> <span class="nf">generate_projectile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Projectile object and its corresponding Crater.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for initializing the Projectile object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (Projectile, Crater)</span>
<span class="sd">            A tuple containing the newly created Projectile and Crater objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">projectile</span> <span class="o">=</span> <span class="n">Projectile</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">crater</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">projectile_to_crater</span><span class="p">(</span><span class="n">projectile</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">projectile</span><span class="p">,</span> <span class="n">crater</span>


    <span class="k">def</span> <span class="nf">emplace_crater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_projectile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emplace a crater in the simulation, optionally based on a projectile.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        from_projectile : bool, optional</span>
<span class="sd">            Flag to create a crater based on a projectile, default is False.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for initializing the Crater or Projectile object.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="n">from_projectile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crater</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_projectile</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crater</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_crater</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;crater_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">get_node_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crater</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;crater_bearing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">get_node_initial_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crater</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>

        <span class="c1"># self.crater.average_surface_normal_vector = self.surf.get_average_surface(self.crater.location, self.crater.radius)</span>
        <span class="c1">#self.crater.morphology.form_crater(self.surf)</span>

        <span class="k">return</span>  


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current simulation state to a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">save_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">export_vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                   <span class="n">out_dir</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the surface mesh to a VTK file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        out_dir : str, Default &quot;vtk_files&quot;</span>
<span class="sd">            Directory to store the VTK files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simdir</span><span class="p">,</span> <span class="s2">&quot;vtk_files&quot;</span><span class="p">)</span>
        <span class="n">ignore_time</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">dims</span>

        <span class="c1"># Save the surface data to a combined netCDF file</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">combine_data_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">)</span>

            <span class="c1"># Use elevation data to modify the mesh for visualization purposes</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_file</span><span class="p">)</span>

            <span class="n">vert_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;yVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;zVertex&#39;</span><span class="p">]</span>

            <span class="n">ds_new</span> <span class="o">=</span> <span class="n">elevation_to_cartesian</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">vert_vars</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vert_vars</span><span class="p">:</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_new</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

            <span class="n">face_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xCell&#39;</span><span class="p">,</span> <span class="s1">&#39;yCell&#39;</span><span class="p">,</span> <span class="s1">&#39;zCell&#39;</span><span class="p">]</span>
            <span class="n">ds_new</span> <span class="o">=</span> <span class="n">elevation_to_cartesian</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">face_vars</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nodal_average</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">face_vars</span><span class="p">:</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_new</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;surface_mesh.nc&quot;</span><span class="p">))</span>

            <span class="c1"># Combine the grid and data into one file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">extract_vtk</span><span class="p">(</span>
                    <span class="n">filename_pattern</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;*.nc&quot;</span><span class="p">),</span>
                    <span class="n">mesh_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;surface_mesh.nc&quot;</span><span class="p">),</span>
                    <span class="n">variable_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;allOnVertices&#39;</span><span class="p">,</span> <span class="s1">&#39;allOnCells&#39;</span><span class="p">]</span> <span class="p">,</span> 
                    <span class="n">dimension_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;maxEdges=&#39;</span><span class="p">,</span><span class="s1">&#39;vertexDegree=&#39;</span><span class="p">],</span> 
                    <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">include_mesh_vars</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span> 
                    <span class="n">ignore_time</span><span class="o">=</span><span class="n">ignore_time</span><span class="p">,</span> 
                    <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error in mpas_tools.viz.paraview_extractor.extract_vtk. Cannot export VTK files&quot;</span><span class="p">)</span>

        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">apply_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;turbulence&quot;</span><span class="p">,</span>
                    <span class="n">noise_width</span><span class="o">=</span><span class="mf">1000e3</span><span class="p">,</span>
                    <span class="n">noise_height</span><span class="o">=</span><span class="mf">20e3</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies a specified noise model to the simulation&#39;s surface elevation.</span>

<span class="sd">        This method adjusts the surface elevation of the simulation based on the chosen noise model. It supports various noise models, each with its own set of default and customizable parameters. The method also ensures that the applied noise is volume-conserving.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : str, optional</span>
<span class="sd">            The noise model to apply. Supported models include &#39;turbulence&#39;, &#39;billowed&#39;, &#39;plaw&#39;, &#39;ridged&#39;, &#39;swiss&#39;, and &#39;jordan&#39;. The default is &#39;turbulence&#39;.</span>
<span class="sd">        noise_width : float, optional</span>
<span class="sd">            The width scale of the noise in meters. The default is 1000e3 (1000 km).</span>
<span class="sd">        noise_height : float, optional</span>
<span class="sd">            The height scale of the noise in meters. The default is 20e3 (20 km).</span>
<span class="sd">        **kwargs :</span>
<span class="sd">            Additional keyword arguments specific to the noise model. Common parameters include &#39;num_octaves&#39; and &#39;anchor&#39;. Model-specific parameters like &#39;freq&#39;, &#39;pers&#39;, &#39;slope&#39;, &#39;lacunarity&#39;, &#39;gain&#39;, etc., can also be set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            This method modifies the simulation&#39;s surface elevation in-place and does not return a value.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The noise is scaled to be volume-conserving, ensuring the mean of the noise is zero.</span>
<span class="sd">        - The method internally calculates normalized coordinates based on the target radius and scales the noise appropriately.</span>
<span class="sd">        - Default values for noise parameters are set based on the chosen model.</span>
<span class="sd">        - For details on thes noise models, see https://www.decarpentier.nl/scape-procedural-basics</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Apply default turbulence noise:</span>

<span class="sd">        &gt;&gt;&gt; sim = cratermaker.Simulation()</span>
<span class="sd">        &gt;&gt;&gt; sim.apply_noise()</span>

<span class="sd">        Apply ridged noise with custom parameters:</span>

<span class="sd">        &gt;&gt;&gt; sim.apply_noise(model=&quot;ridged&quot;, noise_width=500e3, num_octaves=10, freq=1.5)</span>
<span class="sd">        &quot;&quot;&quot;</span>      
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="n">noise_width</span>
        <span class="n">num_octaves</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;num_octaves&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">num_octaves</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span> 

        <span class="c1"># Set reasonable default values for the different models</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;turbulence&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;billowed&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;plaw&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;ridged&quot;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;noise_height&quot;</span><span class="p">,</span> <span class="n">noise_height</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;pers&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;plaw&quot;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;slope&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;swiss&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;jordan&quot;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;lacunarity&quot;</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;gain&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;warp&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;jordan&quot;</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;gain0&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;warp0&quot;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;damp0&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;damp&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;damp_scale&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> 

        <span class="k">if</span> <span class="s2">&quot;noise_height&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;noise_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;noise_height&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span>

        <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;node_x&#39;</span><span class="p">,</span> <span class="s1">&#39;node_y&#39;</span><span class="p">,</span> <span class="s1">&#39;node_z&#39;</span><span class="p">]</span>
        <span class="n">ds_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">uxgrid</span><span class="o">.</span><span class="n">_ds</span><span class="p">[</span><span class="nb">vars</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">ds_norm</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ds_norm</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">ds_norm</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">apply_noise</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">num_octaves</span><span class="p">,</span> <span class="n">anchor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Make sure the noise is volume-conserving (i.e., the mean is zero)</span>
        <span class="c1"># TODO: Take into account the nodes are not uniformly distributed on the sphere</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span><span class="s2">&quot;swiss&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;jordan&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noise</span> <span class="o">*</span> <span class="n">noise_height</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noise</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span> 

        <span class="k">return</span>


    <span class="k">def</span> <span class="nf">set_elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the elevation on the surface. Delegates to the Surface object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args: Variable length argument list to pass to self.surf.set_elevation.</span>
<span class="sd">        **kwargs: Arbitrary keyword arguments to pass to self.surf.set_elevation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">set_elevation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">data_dir</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grid_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">grid_file</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">elevation_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">elevation_file</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">uxgrid</span><span class="o">.</span><span class="n">n_node</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_face</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">uxgrid</span><span class="o">.</span><span class="n">n_face</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;Moon&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reset_surface</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">simdir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the Simulation object.</p>
<h5 id="cratermaker.core.simulation.Simulation.__init__--parameters">Parameters</h5>
<p>target: str or Target, optional, default "Moon"
    Name of the target body or Target object for the simulation, default is "Moon".
material : str or Material, optional
    Name of the material or Material object for the target body, if None is passed, the default material for the target body is used.
pix : float, optional
    Pixel resolution for the mesh, default is None.
reset_surface : bool, optional
    Flag to reset the surface elevation, default is True.
simdir: PathLike, optional
    Path to the simulation directory, default is current working directory.
**kwargs : Any
    Additional keyword arguments.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">target</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Target</span> <span class="o">=</span> <span class="s2">&quot;Moon&quot;</span><span class="p">,</span>
            <span class="n">material</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Material</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">pix</span><span class="p">:</span> <span class="n">FloatLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">reset_surface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">simdir</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">scale</span><span class="p">:</span> <span class="n">Scale</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">morphology</span><span class="p">:</span> <span class="n">Morphology</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the Simulation object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target: str or Target, optional, default &quot;Moon&quot;</span>
<span class="sd">        Name of the target body or Target object for the simulation, default is &quot;Moon&quot;.</span>
<span class="sd">    material : str or Material, optional</span>
<span class="sd">        Name of the material or Material object for the target body, if None is passed, the default material for the target body is used.</span>
<span class="sd">    pix : float, optional</span>
<span class="sd">        Pixel resolution for the mesh, default is None.</span>
<span class="sd">    reset_surface : bool, optional</span>
<span class="sd">        Flag to reset the surface elevation, default is True.</span>
<span class="sd">    simdir: PathLike, optional</span>
<span class="sd">        Path to the simulation directory, default is current working directory.</span>
<span class="sd">    **kwargs : Any</span>
<span class="sd">        Additional keyword arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">simdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">simdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">simdir</span><span class="p">):</span>
        <span class="n">simdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">simdir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">simdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">simdir</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">simdir</span> <span class="o">=</span> <span class="n">simdir</span>

    <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">material</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid material name </span><span class="si">{</span><span class="n">material</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="n">Material</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;materiat must be an instance of Material or a valid name of a material&quot;</span><span class="p">)</span>        

    <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="s2">&quot;Moon&quot;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="s2">&quot;Moon&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">material</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">Target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid target name </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Target</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Target</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;target must be an instance of Target or a valid name of a target body&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>

    <span class="k">if</span> <span class="n">pix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">pix</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span>  <span class="c1"># Default mesh scale that is somewhat comparable to a 1000x1000 CTEM grid</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_surface</span><span class="p">(</span><span class="n">pix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pix</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">reset_surface</span><span class="o">=</span><span class="n">reset_surface</span><span class="p">,</span> <span class="n">simdir</span><span class="o">=</span><span class="n">simdir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Set some default values for the simulation parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_function</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time_function&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tstart</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tstart&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># Simulation start time (in y)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tstop</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tstop&#39;</span><span class="p">,</span> <span class="mf">4.31e9</span><span class="p">)</span>    <span class="c1"># Simulation stop time (in y)</span>

    <span class="c1"># Set some default values for the production function population</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">impactor_sfd</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impactor_sfd&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">impactor_velocity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impactor_velocity&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Set the random number generator seed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_crater</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_projectile</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">Scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">Scale</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scale must be an instance of Scale&quot;</span><span class="p">)</span> 


    <span class="k">if</span> <span class="n">morphology</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">morphology</span><span class="p">,</span> <span class="n">Morphology</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span> <span class="o">=</span> <span class="n">morphology</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;morphology must be an instance of Morphology&quot;</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.apply_noise" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">apply_noise</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;turbulence&#39;</span><span class="p">,</span> <span class="n">noise_width</span><span class="o">=</span><span class="mf">1000000.0</span><span class="p">,</span> <span class="n">noise_height</span><span class="o">=</span><span class="mf">20000.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Applies a specified noise model to the simulation's surface elevation.</p>
<p>This method adjusts the surface elevation of the simulation based on the chosen noise model. It supports various noise models, each with its own set of default and customizable parameters. The method also ensures that the applied noise is volume-conserving.</p>
<h5 id="cratermaker.core.simulation.Simulation.apply_noise--parameters">Parameters</h5>
<p>model : str, optional
    The noise model to apply. Supported models include 'turbulence', 'billowed', 'plaw', 'ridged', 'swiss', and 'jordan'. The default is 'turbulence'.
noise_width : float, optional
    The width scale of the noise in meters. The default is 1000e3 (1000 km).
noise_height : float, optional
    The height scale of the noise in meters. The default is 20e3 (20 km).
**kwargs :
    Additional keyword arguments specific to the noise model. Common parameters include 'num_octaves' and 'anchor'. Model-specific parameters like 'freq', 'pers', 'slope', 'lacunarity', 'gain', etc., can also be set.</p>
<h5 id="cratermaker.core.simulation.Simulation.apply_noise--returns">Returns</h5>
<p>None
    This method modifies the simulation's surface elevation in-place and does not return a value.</p>
<h5 id="cratermaker.core.simulation.Simulation.apply_noise--notes">Notes</h5>
<ul>
<li>The noise is scaled to be volume-conserving, ensuring the mean of the noise is zero.</li>
<li>The method internally calculates normalized coordinates based on the target radius and scales the noise appropriately.</li>
<li>Default values for noise parameters are set based on the chosen model.</li>
<li>For details on thes noise models, see https://www.decarpentier.nl/scape-procedural-basics</li>
</ul>
<h5 id="cratermaker.core.simulation.Simulation.apply_noise--examples">Examples</h5>
<p>Apply default turbulence noise:</p>
<blockquote>
<blockquote>
<blockquote>
<p>sim = cratermaker.Simulation()
sim.apply_noise()</p>
</blockquote>
</blockquote>
</blockquote>
<p>Apply ridged noise with custom parameters:</p>
<blockquote>
<blockquote>
<blockquote>
<p>sim.apply_noise(model="ridged", noise_width=500e3, num_octaves=10, freq=1.5)</p>
</blockquote>
</blockquote>
</blockquote>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                <span class="n">model</span><span class="o">=</span><span class="s2">&quot;turbulence&quot;</span><span class="p">,</span>
                <span class="n">noise_width</span><span class="o">=</span><span class="mf">1000e3</span><span class="p">,</span>
                <span class="n">noise_height</span><span class="o">=</span><span class="mf">20e3</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies a specified noise model to the simulation&#39;s surface elevation.</span>

<span class="sd">    This method adjusts the surface elevation of the simulation based on the chosen noise model. It supports various noise models, each with its own set of default and customizable parameters. The method also ensures that the applied noise is volume-conserving.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : str, optional</span>
<span class="sd">        The noise model to apply. Supported models include &#39;turbulence&#39;, &#39;billowed&#39;, &#39;plaw&#39;, &#39;ridged&#39;, &#39;swiss&#39;, and &#39;jordan&#39;. The default is &#39;turbulence&#39;.</span>
<span class="sd">    noise_width : float, optional</span>
<span class="sd">        The width scale of the noise in meters. The default is 1000e3 (1000 km).</span>
<span class="sd">    noise_height : float, optional</span>
<span class="sd">        The height scale of the noise in meters. The default is 20e3 (20 km).</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Additional keyword arguments specific to the noise model. Common parameters include &#39;num_octaves&#39; and &#39;anchor&#39;. Model-specific parameters like &#39;freq&#39;, &#39;pers&#39;, &#39;slope&#39;, &#39;lacunarity&#39;, &#39;gain&#39;, etc., can also be set.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        This method modifies the simulation&#39;s surface elevation in-place and does not return a value.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The noise is scaled to be volume-conserving, ensuring the mean of the noise is zero.</span>
<span class="sd">    - The method internally calculates normalized coordinates based on the target radius and scales the noise appropriately.</span>
<span class="sd">    - Default values for noise parameters are set based on the chosen model.</span>
<span class="sd">    - For details on thes noise models, see https://www.decarpentier.nl/scape-procedural-basics</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Apply default turbulence noise:</span>

<span class="sd">    &gt;&gt;&gt; sim = cratermaker.Simulation()</span>
<span class="sd">    &gt;&gt;&gt; sim.apply_noise()</span>

<span class="sd">    Apply ridged noise with custom parameters:</span>

<span class="sd">    &gt;&gt;&gt; sim.apply_noise(model=&quot;ridged&quot;, noise_width=500e3, num_octaves=10, freq=1.5)</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span> <span class="o">/</span> <span class="n">noise_width</span>
    <span class="n">num_octaves</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;num_octaves&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="n">anchor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">num_octaves</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span> 

    <span class="c1"># Set reasonable default values for the different models</span>
    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;turbulence&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;billowed&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;plaw&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;ridged&quot;</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;noise_height&quot;</span><span class="p">,</span> <span class="n">noise_height</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;pers&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;plaw&quot;</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;slope&quot;</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;swiss&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;jordan&quot;</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;lacunarity&quot;</span><span class="p">,</span> <span class="mf">2.00</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;gain&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;warp&quot;</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;jordan&quot;</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;gain0&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;warp0&quot;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;damp0&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;damp&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;damp_scale&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> 

    <span class="k">if</span> <span class="s2">&quot;noise_height&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;noise_height&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;noise_height&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span>

    <span class="nb">vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;node_x&#39;</span><span class="p">,</span> <span class="s1">&#39;node_y&#39;</span><span class="p">,</span> <span class="s1">&#39;node_z&#39;</span><span class="p">]</span>
    <span class="n">ds_norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">uxgrid</span><span class="o">.</span><span class="n">_ds</span><span class="p">[</span><span class="nb">vars</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ds_norm</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">ds_norm</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">ds_norm</span><span class="p">[</span><span class="nb">vars</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">apply_noise</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">num_octaves</span><span class="p">,</span> <span class="n">anchor</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Make sure the noise is volume-conserving (i.e., the mean is zero)</span>
    <span class="c1"># TODO: Take into account the nodes are not uniformly distributed on the sphere</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">noise</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span><span class="s2">&quot;swiss&quot;</span> <span class="ow">or</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;jordan&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noise</span> <span class="o">*</span> <span class="n">noise_height</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noise</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">radius</span> 

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.emplace_crater" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">emplace_crater</span><span class="p">(</span><span class="n">from_projectile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Emplace a crater in the simulation, optionally based on a projectile.</p>
<h5 id="cratermaker.core.simulation.Simulation.emplace_crater--parameters">Parameters</h5>
<p>from_projectile : bool, optional
    Flag to create a crater based on a projectile, default is False.
**kwargs : dict
    Keyword arguments for initializing the Crater or Projectile object.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">emplace_crater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_projectile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Emplace a crater in the simulation, optionally based on a projectile.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    from_projectile : bool, optional</span>
<span class="sd">        Flag to create a crater based on a projectile, default is False.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments for initializing the Crater or Projectile object.</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="k">if</span> <span class="n">from_projectile</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crater</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_projectile</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crater</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projectile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_crater</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;crater_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">get_node_distance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crater</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;crater_bearing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">get_node_initial_bearing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crater</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>

    <span class="c1"># self.crater.average_surface_normal_vector = self.surf.get_average_surface(self.crater.location, self.crater.radius)</span>
    <span class="c1">#self.crater.morphology.form_crater(self.surf)</span>

    <span class="k">return</span>  
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.export_vtk" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">export_vtk</span><span class="p">(</span><span class="n">out_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Export the surface mesh to a VTK file.</p>
<h5 id="cratermaker.core.simulation.Simulation.export_vtk--parameters">Parameters</h5>
<p>out_dir : str, Default "vtk_files"
    Directory to store the VTK files.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
               <span class="n">out_dir</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
               <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export the surface mesh to a VTK file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    out_dir : str, Default &quot;vtk_files&quot;</span>
<span class="sd">        Directory to store the VTK files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">out_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simdir</span><span class="p">,</span> <span class="s2">&quot;vtk_files&quot;</span><span class="p">)</span>
    <span class="n">ignore_time</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">dims</span>

    <span class="c1"># Save the surface data to a combined netCDF file</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">combine_data_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">out_dir</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">)</span>

        <span class="c1"># Use elevation data to modify the mesh for visualization purposes</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_file</span><span class="p">)</span>

        <span class="n">vert_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;yVertex&#39;</span><span class="p">,</span> <span class="s1">&#39;zVertex&#39;</span><span class="p">]</span>

        <span class="n">ds_new</span> <span class="o">=</span> <span class="n">elevation_to_cartesian</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">vert_vars</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">vert_vars</span><span class="p">:</span>
            <span class="n">grid</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_new</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

        <span class="n">face_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xCell&#39;</span><span class="p">,</span> <span class="s1">&#39;yCell&#39;</span><span class="p">,</span> <span class="s1">&#39;zCell&#39;</span><span class="p">]</span>
        <span class="n">ds_new</span> <span class="o">=</span> <span class="n">elevation_to_cartesian</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">face_vars</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">[</span><span class="s1">&#39;elevation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nodal_average</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">face_vars</span><span class="p">:</span>
            <span class="n">grid</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_new</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>

        <span class="n">grid</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;surface_mesh.nc&quot;</span><span class="p">))</span>

        <span class="c1"># Combine the grid and data into one file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">extract_vtk</span><span class="p">(</span>
                <span class="n">filename_pattern</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;*.nc&quot;</span><span class="p">),</span>
                <span class="n">mesh_filename</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="s2">&quot;surface_mesh.nc&quot;</span><span class="p">),</span>
                <span class="n">variable_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;allOnVertices&#39;</span><span class="p">,</span> <span class="s1">&#39;allOnCells&#39;</span><span class="p">]</span> <span class="p">,</span> 
                <span class="n">dimension_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;maxEdges=&#39;</span><span class="p">,</span><span class="s1">&#39;vertexDegree=&#39;</span><span class="p">],</span> 
                <span class="n">combine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">include_mesh_vars</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">out_dir</span><span class="o">=</span><span class="n">out_dir</span><span class="p">,</span> 
                <span class="n">ignore_time</span><span class="o">=</span><span class="n">ignore_time</span><span class="p">,</span> 
                <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Error in mpas_tools.viz.paraview_extractor.extract_vtk. Cannot export VTK files&quot;</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.generate_crater" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_crater</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a new Crater object and its corresponding Projectile.</p>
<h5 id="cratermaker.core.simulation.Simulation.generate_crater--parameters">Parameters</h5>
<p>**kwargs : dict
    Keyword arguments for initializing the Crater object.</p>
<h5 id="cratermaker.core.simulation.Simulation.generate_crater--returns">Returns</h5>
<p>(Crater, Projectile)
    A tuple containing the newly created Crater and Projectile objects.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_crater</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Crater object and its corresponding Projectile.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments for initializing the Crater object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (Crater, Projectile)</span>
<span class="sd">        A tuple containing the newly created Crater and Projectile objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="c1"># Create a new Crater object with the passed arguments and set it as the crater of this simulation</span>
    <span class="n">crater</span> <span class="o">=</span> <span class="n">Crater</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">projectile</span> <span class="o">=</span> <span class="n">crater</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">crater_to_projectile</span><span class="p">(</span><span class="n">crater</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">crater</span><span class="p">,</span> <span class="n">projectile</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.generate_projectile" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_projectile</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a new Projectile object and its corresponding Crater.</p>
<h5 id="cratermaker.core.simulation.Simulation.generate_projectile--parameters">Parameters</h5>
<p>**kwargs : dict
    Keyword arguments for initializing the Projectile object.</p>
<h5 id="cratermaker.core.simulation.Simulation.generate_projectile--returns">Returns</h5>
<p>(Projectile, Crater)
    A tuple containing the newly created Projectile and Crater objects.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_projectile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Projectile object and its corresponding Crater.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments for initializing the Projectile object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (Projectile, Crater)</span>
<span class="sd">        A tuple containing the newly created Projectile and Crater objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">projectile</span> <span class="o">=</span> <span class="n">Projectile</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">crater</span> <span class="o">=</span> <span class="n">projectile</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">projectile_to_crater</span><span class="p">(</span><span class="n">projectile</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">projectile</span><span class="p">,</span> <span class="n">crater</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.initialize_surface" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">initialize_surface</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the surface mesh.</p>
<h5 id="cratermaker.core.simulation.Simulation.initialize_surface--parameters">Parameters</h5>
<p><em>args : dict
    Variable length argument list to pass to initialize_surface.
</em>*kwargs : dict
    Keyword arguments for initializing the surface mesh.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">initialize_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the surface mesh.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args : dict</span>
<span class="sd">        Variable length argument list to pass to initialize_surface.</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        Keyword arguments for initializing the surface mesh.</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="bp">self</span><span class="o">.</span><span class="n">surf</span> <span class="o">=</span> <span class="n">initialize_surface</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.save" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save the current simulation state to a file.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the current simulation state to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">save_surface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.set_elevation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_elevation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Set the elevation on the surface. Delegates to the Surface object.</p>
<h5 id="cratermaker.core.simulation.Simulation.set_elevation--parameters">Parameters</h5>
<p><em>args: Variable length argument list to pass to self.surf.set_elevation.
</em>*kwargs: Arbitrary keyword arguments to pass to self.surf.set_elevation.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_elevation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the elevation on the surface. Delegates to the Surface object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args: Variable length argument list to pass to self.surf.set_elevation.</span>
<span class="sd">    **kwargs: Arbitrary keyword arguments to pass to self.surf.set_elevation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf</span><span class="o">.</span><span class="n">set_elevation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.set_properties" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">set_properties</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Set properties of the current object based on the provided keyword arguments.</p>
<p>This function is a utility to update the properties of the current object. The actual implementation of the 
property setting is handled by the <code>utils.set_properties</code> method.</p>
<h5 id="cratermaker.core.simulation.Simulation.set_properties--parameters">Parameters</h5>
<p>**kwargs : dict
    A dictionary of keyword arguments that represent the properties to be set on the current object.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set properties of the current object based on the provided keyword arguments.</span>

<span class="sd">    This function is a utility to update the properties of the current object. The actual implementation of the </span>
<span class="sd">    property setting is handled by the `utils.set_properties` method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **kwargs : dict</span>
<span class="sd">        A dictionary of keyword arguments that represent the properties to be set on the current object.</span>

<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="n">set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> 
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="cratermaker.core.simulation.Simulation.to_json" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Export the current simulation configuration to a JSON file.</p>
<h5 id="cratermaker.core.simulation.Simulation.to_json--parameters">Parameters</h5>
<p>filename : str
    The file path where the JSON configuration will be saved.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/core/simulation.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export the current simulation configuration to a JSON file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The file path where the JSON configuration will be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    <span class="c1">#TODO: Re-do this once the dust settles a bit</span>
    <span class="c1"># Get the simulation configuration into the correct structure</span>
    <span class="n">material_config</span> <span class="o">=</span> <span class="n">to_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
    <span class="n">target_config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">to_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">),</span> <span class="s1">&#39;material&#39;</span> <span class="p">:</span> <span class="n">material_config</span><span class="p">}</span>
    <span class="n">sim_config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">to_config</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span><span class="s1">&#39;target&#39;</span> <span class="p">:</span> <span class="n">target_config</span><span class="p">}</span> 

    <span class="c1"># Write the combined configuration to a JSON file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sim_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
