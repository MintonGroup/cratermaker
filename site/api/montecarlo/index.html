<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Monte Carlo Utilities - CraterMaker Documentation</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">CraterMaker Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../cratermaker_overview/" class="nav-link">Overview</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">API Reference <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../crater/" class="dropdown-item">Crater</a>
</li>
                                    
<li>
    <a href="../morphology/" class="dropdown-item">Morphology</a>
</li>
                                    
<li>
    <a href="../production/" class="dropdown-item">Production</a>
</li>
                                    
<li>
    <a href="../scale/" class="dropdown-item">Scale</a>
</li>
                                    
<li>
    <a href="../simulation/" class="dropdown-item">Simulation</a>
</li>
                                    
<li>
    <a href="../surface/" class="dropdown-item">Surface</a>
</li>
                                    
<li>
    <a href="../target/" class="dropdown-item">Target</a>
</li>
                                    
<li>
    <a href="../general_utils/" class="dropdown-item">General Utilities</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Monte Carlo Utilities</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../license/" class="nav-link">License</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../general_utils/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../license/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#monte-carlo-utility-module" class="nav-link">Monte Carlo Utility Module</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#cratermaker.utils.montecarlo" class="nav-link">montecarlo</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cratermaker.utils.montecarlo.bounded_norm" class="nav-link">bounded_norm()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cratermaker.utils.montecarlo.get_random_impact_angle" class="nav-link">get_random_impact_angle()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cratermaker.utils.montecarlo.get_random_location" class="nav-link">get_random_location()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cratermaker.utils.montecarlo.get_random_size" class="nav-link">get_random_size()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#cratermaker.utils.montecarlo.get_random_velocity" class="nav-link">get_random_velocity()</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="monte-carlo-utility-module">Monte Carlo Utility Module</h1>


<div class="doc doc-object doc-module">



<a id="cratermaker.utils.montecarlo"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="cratermaker.utils.montecarlo.bounded_norm" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">bounded_norm</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Sample from a truncated normal distribution that is bounded by 1-sigma stdev</p>
<h4 id="cratermaker.utils.montecarlo.bounded_norm--parameters">Parameters</h4>
<p>loc : float
   mean of the distribution
scale : float
   standard deviation and bounds of the distribution</p>
<h4 id="cratermaker.utils.montecarlo.bounded_norm--returns">Returns</h4>
<p>float
   Truncated norm bounded by loc-scale, loc+scale</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/utils/montecarlo.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bounded_norm</span><span class="p">(</span><span class="n">loc</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span><span class="n">scale</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span><span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample from a truncated normal distribution that is bounded by 1-sigma stdev</span>

<span class="sd">    Parameters </span>
<span class="sd">    ----------</span>
<span class="sd">    loc : float</span>
<span class="sd">       mean of the distribution</span>
<span class="sd">    scale : float</span>
<span class="sd">       standard deviation and bounds of the distribution</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    float</span>
<span class="sd">       Truncated norm bounded by loc-scale, loc+scale</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">-</span> <span class="n">scale</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">+</span> <span class="n">scale</span>
    <span class="n">truncated_normal</span> <span class="o">=</span> <span class="n">truncnorm</span><span class="p">(</span>
          <span class="p">(</span><span class="n">lower_bound</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span><span class="p">,</span>
            <span class="p">(</span><span class="n">upper_bound</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span><span class="p">,</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">truncated_normal</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">truncated_normal</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cratermaker.utils.montecarlo.get_random_impact_angle" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_random_impact_angle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Sample impact angles from a distribution centered on 45deg.</p>
<p>For the theory, see Shoemaker (1962) "Interpretation of lunar craters."</p>
<h4 id="cratermaker.utils.montecarlo.get_random_impact_angle--parameters">Parameters</h4>
<p>size : int or tuple of ints, optional
    The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None (the default), a single value is returned if <code>diameters</code> is a scalar, otherwise an array of samples is returned with the same size as <code>diameters</code>.
rng : numpy.random.Generator, optional
    An instance of a random number generator compatible with numpy's random generators. If not provided, <code>default_rng</code> is used to create a new instance.     </p>
<h4 id="cratermaker.utils.montecarlo.get_random_impact_angle--returns">Returns</h4>
<p>np.float64 or ndarray of np.float 64 
    A scalar or array of impact angles (in degrees).</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/utils/montecarlo.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_random_impact_angle</span><span class="p">(</span>
                            <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                            <span class="n">rng</span><span class="p">:</span> <span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample impact angles from a distribution centered on 45deg.</span>

<span class="sd">    For the theory, see Shoemaker (1962) &quot;Interpretation of lunar craters.&quot;</span>

<span class="sd">    Parameters </span>
<span class="sd">    ----------</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None (the default), a single value is returned if `diameters` is a scalar, otherwise an array of samples is returned with the same size as `diameters`.</span>
<span class="sd">    rng : numpy.random.Generator, optional</span>
<span class="sd">        An instance of a random number generator compatible with numpy&#39;s random generators. If not provided, `default_rng` is used to create a new instance.     </span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    np.float64 or ndarray of np.float 64 </span>
<span class="sd">        A scalar or array of impact angles (in degrees).</span>
<span class="sd">    &quot;&quot;&quot;</span>    

    <span class="k">if</span> <span class="n">rng</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">Generator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The &#39;rng&#39; argument must be a numpy.random.Generator instance or None&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span> 

    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
    <span class="n">impact_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">impact_angle</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">impact_angle</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cratermaker.utils.montecarlo.get_random_location" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_random_location</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Computes random longitude and latitude values.</p>
<p>Generates a set of latitude and longitude values that are uniformly distributed on the surface of a sphere.</p>
<h4 id="cratermaker.utils.montecarlo.get_random_location--parameters">Parameters</h4>
<p>size : int or tuple of ints, optional
    The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None (the default), a single value is returned if <code>diameters</code> is a scalar, otherwise an array of samples is returned with the same size as <code>diameters</code>.
rng : numpy.random.Generator, optional
    An instance of a random number generator compatible with numpy's random generators. If not provided, <code>default_rng</code> is used to create a new instance.</p>
<h4 id="cratermaker.utils.montecarlo.get_random_location--returns">Returns</h4>
<p>(lon,lat) or ndarray[(lon,lat)] of given size
    A pair or array of pairs of longitude and latitude values in degrees.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/utils/montecarlo.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_random_location</span><span class="p">(</span>
                        <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                        <span class="n">rng</span><span class="p">:</span> <span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> <span class="n">ArrayLike</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes random longitude and latitude values.</span>

<span class="sd">    Generates a set of latitude and longitude values that are uniformly distributed on the surface of a sphere.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None (the default), a single value is returned if `diameters` is a scalar, otherwise an array of samples is returned with the same size as `diameters`.</span>
<span class="sd">    rng : numpy.random.Generator, optional</span>
<span class="sd">        An instance of a random number generator compatible with numpy&#39;s random generators. If not provided, `default_rng` is used to create a new instance.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (lon,lat) or ndarray[(lon,lat)] of given size</span>
<span class="sd">        A pair or array of pairs of longitude and latitude values in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">rng</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">Generator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The &#39;rng&#39; argument must be a numpy.random.Generator instance or None&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span> 

    <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="c1"># Compute the angles theta and phi</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">u</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Convert to lon/lat</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="c1"># Use the convention that longitude is in the range [-180, 180]</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">phi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">item</span><span class="p">()),</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Reshape lat and lon to the original size if necessary</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="c1"># Combine lat and lon into a structured array</span>
        <span class="n">lonlat_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">)])</span>
        <span class="n">lonlat_arr</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span>
        <span class="n">lonlat_arr</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat</span>

    <span class="k">return</span> <span class="n">lonlat_arr</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cratermaker.utils.montecarlo.get_random_size" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_random_size</span><span class="p">(</span><span class="n">diameters</span><span class="p">,</span> <span class="n">cdf</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Sample diameters from a cumulative size-frequency distribution (SFD).</p>
<p>Given an array of diameters and optionally a cumulative distribution function (CDF), this function generates new diameter values that follow the specified distribution. The SFD is treated as a continuous function that interpolates between the provided diameters, which are assumed to represent a power-law distribution.</p>
<h4 id="cratermaker.utils.montecarlo.get_random_size--parameters">Parameters</h4>
<p>diameters : array_like
    An array of diameters from which the SFD is constructed. Must be 1-dimensional.
cdf : array_like
    The cumulative distribution function corresponding to <code>diameters</code>. Must be the same size as <code>diameters</code> and must be monotonically increasing with decreasing diameter value.
size : int or tuple of ints, optional
    The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None and mu is None then a single value is returned. Note: mu and size are mutually exclusive. 
mu : int or tuple of ints, optional
    The expected number of samples to generate using a Poisson random number genertor. If the shape is (m, n, k), then m * n * k samples are drawn. Note: mu and size are mutually exclusive. 
rng : numpy.random.Generator, optional
    An instance of a random number generator compatible with numpy's random generators. If not provided, <code>default_rng</code> is used to create a new instance.</p>
<h4 id="cratermaker.utils.montecarlo.get_random_size--returns">Returns</h4>
<p>np.float64 or ndarray of np.float 64 
    A scalar or array of sampled diameter values from the SFD. </p>
<h4 id="cratermaker.utils.montecarlo.get_random_size--notes">Notes</h4>
<p>The SFD is assumed to be a continuous distribution that follows a power-law between the provided discrete diameter values. Linear interpolation in log-space is used to sample new values between the known diameters.
A small amount of random noise (of the order 1e-3 the diameter value) is added to the final diameter value to ensure that diameter values are unlikely to be identical, even when an input CDF could lead to identical diameter values.</p>
<h4 id="cratermaker.utils.montecarlo.get_random_size--examples">Examples</h4>
<blockquote>
<blockquote>
<blockquote>
<p>diameters = np.array([100.,  56.,  32.,  18.,  10.])
ncumul = np.array([1.  , 0.51, 0.21, 0.06, 0.01])
sample_from_sfd(diameters, cdf=ncumul, size=4)
array([14.80803668, 44.95292261, 29.80797715, 23.11082091])</p>
</blockquote>
</blockquote>
</blockquote>
<h4 id="cratermaker.utils.montecarlo.get_random_size--see-also">See Also</h4>
<p>numpy.random.Generator : The numpy random generator class used for random sampling.</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/utils/montecarlo.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_random_size</span><span class="p">(</span><span class="n">diameters</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> 
                    <span class="n">cdf</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">],</span> 
                    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                    <span class="n">mu</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">rng</span><span class="p">:</span> <span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample diameters from a cumulative size-frequency distribution (SFD).</span>

<span class="sd">    Given an array of diameters and optionally a cumulative distribution function (CDF), this function generates new diameter values that follow the specified distribution. The SFD is treated as a continuous function that interpolates between the provided diameters, which are assumed to represent a power-law distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    diameters : array_like</span>
<span class="sd">        An array of diameters from which the SFD is constructed. Must be 1-dimensional.</span>
<span class="sd">    cdf : array_like</span>
<span class="sd">        The cumulative distribution function corresponding to `diameters`. Must be the same size as `diameters` and must be monotonically increasing with decreasing diameter value.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None and mu is None then a single value is returned. Note: mu and size are mutually exclusive. </span>
<span class="sd">    mu : int or tuple of ints, optional</span>
<span class="sd">        The expected number of samples to generate using a Poisson random number genertor. If the shape is (m, n, k), then m * n * k samples are drawn. Note: mu and size are mutually exclusive. </span>
<span class="sd">    rng : numpy.random.Generator, optional</span>
<span class="sd">        An instance of a random number generator compatible with numpy&#39;s random generators. If not provided, `default_rng` is used to create a new instance.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.float64 or ndarray of np.float 64 </span>
<span class="sd">        A scalar or array of sampled diameter values from the SFD. </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The SFD is assumed to be a continuous distribution that follows a power-law between the provided discrete diameter values. Linear interpolation in log-space is used to sample new values between the known diameters.</span>
<span class="sd">    A small amount of random noise (of the order 1e-3 the diameter value) is added to the final diameter value to ensure that diameter values are unlikely to be identical, even when an input CDF could lead to identical diameter values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; diameters = np.array([100.,  56.,  32.,  18.,  10.])</span>
<span class="sd">    &gt;&gt;&gt; ncumul = np.array([1.  , 0.51, 0.21, 0.06, 0.01])</span>
<span class="sd">    &gt;&gt;&gt; sample_from_sfd(diameters, cdf=ncumul, size=4)</span>
<span class="sd">    array([14.80803668, 44.95292261, 29.80797715, 23.11082091])</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    numpy.random.Generator : The numpy random generator class used for random sampling.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if rng has &#39;uniform&#39; method which is a characteristic of numpy&#39;s random generator objects and use that to generate our values</span>
    <span class="k">if</span> <span class="n">rng</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">Generator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The &#39;rng&#39; argument must be a numpy.random.Generator instance or None&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span> 

    <span class="c1"># Check that the shapes and sizes of diameters and cdf are compatible</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">diameters</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">cdf</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;diameters&#39; and &#39;cdf&#39; arguments must be arrays&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diameters</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;diameters&#39; argument must be a 1-dimensional array&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diameters</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;diameters&#39; and &#39;cdf&#39; arguments must have the same shape&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diameters</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;diameters&#39; and &#39;cdf&#39; arguments must have the same size&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diameters</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;diameters&#39; and &#39;cdf&#39; arguments must have at least two elements&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">diameters</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All values in the &#39;diameters&#39; argument must be positive&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">cdf</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All values in the &#39;cdf&#39; argument must be positive&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The &#39;size&#39; and &#39;mu&#39; arguments are mutually exclusive&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> 

    <span class="c1"># Sort the diameters in descending order and get the cumulative distribution if it was not supplied</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">diameters</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sorted_diameters</span> <span class="o">=</span> <span class="n">diameters</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">sorted_cdf</span> <span class="o">=</span> <span class="n">cdf</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

    <span class="c1"># Check to make sure that the CDF is correctly specified so that as diameter is decreasing it is monotonically increasing</span>
    <span class="n">is_monotonic_increasing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sorted_cdf</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_monotonic_increasing</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The CDF must be monotonically increasing with decreasing diameter.&quot;</span><span class="p">)</span>

    <span class="c1"># Normalize the cdf and put it in logspace</span>
    <span class="n">sorted_cdf</span> <span class="o">/=</span> <span class="n">sorted_cdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">log_sorted_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sorted_cdf</span><span class="p">)</span>

    <span class="c1"># Generate uniform random numbers for the entire sample size</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="n">sorted_cdf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">high</span><span class="o">=</span><span class="n">sorted_cdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

    <span class="c1"># Handle the situation where u is a scalar (size is None and diameters is a scalar)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u</span><span class="p">])</span>

    <span class="c1"># Flatten u to work with it as a 1D array</span>
    <span class="n">original_shape</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>     

    <span class="c1"># Find the indices where the random numbers would be inserted to maintain order</span>
    <span class="c1"># Use the right side of the interval to avoid edge effects for when u == sorted_cdf[0]</span>
    <span class="c1"># Because rng.uniform returns values in the half-open interval [sorted_cdf[0], sorted_cdf[-1]), u will never be exactly equal to sorted_cdf[-1]</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">log_sorted_cdf</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

    <span class="c1"># Initialize the new_diameters array</span>
    <span class="n">new_diameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">log_diam_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sorted_diameters</span><span class="p">[</span><span class="n">indices</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">log_diam_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sorted_diameters</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
    <span class="n">log_nval_low</span> <span class="o">=</span> <span class="n">log_sorted_cdf</span><span class="p">[</span><span class="n">indices</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">log_nval_high</span> <span class="o">=</span> <span class="n">log_sorted_cdf</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

    <span class="n">fractions</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">log_nval_low</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">log_nval_high</span> <span class="o">-</span> <span class="n">log_nval_low</span><span class="p">)</span>
    <span class="n">log_diam_interp</span> <span class="o">=</span> <span class="n">log_diam_low</span> <span class="o">+</span> <span class="n">fractions</span> <span class="o">*</span> <span class="p">(</span><span class="n">log_diam_high</span> <span class="o">-</span> <span class="n">log_diam_low</span><span class="p">)</span>
    <span class="n">new_diameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_diam_interp</span><span class="p">)</span>

    <span class="c1"># Reshape new_diameters to the original shape of u</span>
    <span class="n">new_diameters</span> <span class="o">=</span> <span class="n">new_diameters</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">original_shape</span><span class="p">)</span>

    <span class="c1"># Add a small random noise to the diameters</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="mf">1e-8</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">new_diameters</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">new_diameters</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new_diameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">new_diameters</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="cratermaker.utils.montecarlo.get_random_velocity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_random_velocity</span><span class="p">(</span><span class="n">vmean</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Sample impact velocities from a Maxwell-Boltzmann distribution given a mean velocity.</p>
<h4 id="cratermaker.utils.montecarlo.get_random_velocity--parameters">Parameters</h4>
<p>vmean : np.float64
    The mean velocity of the distribution.
size : int or tuple of ints, optional
    The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None (the default), a single value is returned if <code>diameters</code> is a scalar, otherwise an array of samples is returned with the same size as <code>diameters</code>.
rng : numpy.random.Generator, optional
    An instance of a random number generator compatible with numpy's random generators. If not provided, <code>default_rng</code> is used to create a new instance.    </p>
<h4 id="cratermaker.utils.montecarlo.get_random_velocity--returns">Returns</h4>
<p>ndarray 
    An array of impact velocities (in m/s).</p>

          <details class="quote">
            <summary>Source code in <code>cratermaker/utils/montecarlo.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_random_velocity</span><span class="p">(</span>
                        <span class="n">vmean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> 
                        <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                        <span class="n">rng</span><span class="p">:</span> <span class="n">Generator</span> <span class="o">|</span> <span class="kc">None</span><span class="o">=</span><span class="kc">None</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sample impact velocities from a Maxwell-Boltzmann distribution given a mean velocity.</span>

<span class="sd">    Parameters </span>
<span class="sd">    ----------</span>
<span class="sd">    vmean : np.float64</span>
<span class="sd">        The mean velocity of the distribution.</span>
<span class="sd">    size : int or tuple of ints, optional</span>
<span class="sd">        The number of samples to generate. If the shape is (m, n, k), then m * n * k samples are drawn. If size is None (the default), a single value is returned if `diameters` is a scalar, otherwise an array of samples is returned with the same size as `diameters`.</span>
<span class="sd">    rng : numpy.random.Generator, optional</span>
<span class="sd">        An instance of a random number generator compatible with numpy&#39;s random generators. If not provided, `default_rng` is used to create a new instance.    </span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    ndarray </span>
<span class="sd">        An array of impact velocities (in m/s).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if rng has &#39;uniform&#39; method which is a characteristic of numpy&#39;s random generator objects and use that to generate our values</span>
    <span class="k">if</span> <span class="n">rng</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="s1">&#39;normal&#39;</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Just use the basic normal random number generator</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The &#39;rng&#39; argument must be a compatible with numpy random generator or None&quot;</span><span class="p">)</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="n">vmean</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="n">vx</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">velocities</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
